## 客户端服务器事务

+ 大多数网络应用都基于客户端服务器模型
  + 一个服务器进程和一个或多个客户端进程
  + 服务器控制一些资源
  + 服务器通过给客户端操作资源来提供服务
  + 服务器被客户端的请求激活(类似自动售货机)
  + 

## 计算机网络

+ 网络是一个由盒子和电线组成的按地理位置排列的层次系统
  + SAN(System area network)跨越集群或机房
    + 交换式以太网，Quadrics QSW
  + LAN(Local area network)跨越建筑物或校园
    + 以太网是最有名的例子
  + WAN(Wide are network)跨越国家或世界
    + 典型的高速点对点电话线
+ 因特网是一组相互连接的网络
  + 全球IP互联网（大写“I”）是internet最著名的例子（小写“I”）

## 最底层：以太网段

+ 以太网段由一组主机组成，这些主机通过导线（双绞线）连接到集线器(hub)
+ 跨越建筑物中的房间或地板
+ 操作
  + 每个以太网适配器有一个唯一的48-bit地址(MAC地址)
    + E.g., 00:16:ea:e3:54:e6
  + 主机在被称为帧(frames)的块中发送比特给其他任何主机
  + hub集线器被动地(slavishly)将每个位从每个端口复制到每个其他端
    + 每一个主机都能看到每一个bit
    + 注意：hub即将退出。网桥（交换机、路由器）变得足够便宜，足以取代它们

## 下一层：桥接以太网段

+ 跨建筑或校园
+ 网桥巧妙地了解哪些主机可以从哪个端口访问，然后有选择地将帧从一个端口复制到另一个端口

## 下一层：因特网(internets)

+ 多个不兼容的局域网可以通过称为路由器的专用计算机进行物理连接
+ 连接的网络称为internet（小写）

## 协议

+ 在互不兼容的LAN和WAN之间传数据
+ 协议软件运行在每个主机与路由器上
  + 协议是一组规则，用来控制主机和路由器在网络间传输数据时应该如何合作。
  + 消除不同网络之间的差异

## 协议做了什么？

+ 提供命名方案

  + 因特网协议定义了主机地址的统一格式
  + 每个主机（和路由器）至少分配一个唯一标识它的因特网地址

+ 提供发送机制

  + 因特网协议定义了一个标准传输单元（包packet）

  + 包由报头和有效载荷组成

    + 报头：包含包大小、源地址和目标地址等信息

    + 有效负载：包含从源主机发送的数据位

![img](https://github.com/Qasak/all-about-computer-system/blob/master/proxylab/%E5%B0%81%E8%A3%85.png)

## 其他重要问题：查阅计算机网络

+ 如果不同的网络有不同的最大帧大小呢？（分段）
+ 路由器如何知道在哪里转发帧？
+ 当网络拓扑结构发生变化时，如何通知路由器？
+ 如果包丢失了怎么办？

## 全球IP互联网(Internet, 大写)

+ 基于TCP/IP协议族
  + IP(Internet Protocol)
    + 提供从*主机到主机*的基本命名方案和不可靠的数据包（数据报）传递能力
  + UDP(Unreliable Datagram Protocol)
    + 使用IP提供从*进程到进程*不可靠数据包传输
  + TCP(Transmission Control Protocol)
    + 使用IP通过链接提供从*进程到进程*可靠的字节流传输

通过混合使用Unix文件I/O和sockets接口的函数进行访问

## 互联网应用的软硬件组织

![img](https://github.com/Qasak/all-about-computer-system/blob/master/proxylab/%E4%BA%92%E8%81%94%E7%BD%91%E5%BA%94%E7%94%A8%E7%9A%84%E8%BD%AF%E7%A1%AC%E4%BB%B6%E7%BB%84%E7%BB%87.png)

## 互联网：程序员的视角

1. 主机映射到32位IP地址
2. IP地址集映射到一组称为Internet域名的标识符
3. 一个Internet主机上的进程可以通过连接与另一个Internet主机上的进程通信

### IP地址

+ 32位IP地址存储在IP地址结构中
  + IP地址总是以网络字节顺序（big-endian字节顺序）存储在内存中

```c
/* Internet address structure */
struct in_addr {
    uint32_t  s_addr; /* network byte order (big-endian) */
};
```

点分十进制

+ 按照惯例，32位IP地址中的每个字节都由其十进制值表示，并用句点分隔
  + IP地址：0x8002C2F2=128.2.194.242

+ 使用`getaddrinfo`和`getnameinfo`函数（稍后介绍）在IP地址和点分隔十进制格式之间进行转换。

